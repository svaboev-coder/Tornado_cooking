# Настройка PostgreSQL базы данных alwaysdata

## Обзор

Этот проект теперь работает только с сетевой PostgreSQL базой данных alwaysdata. Система автоматически подключается к базе данных на основе настроек в файле `.env`.

## Шаги настройки

### 1. Создание базы данных на alwaysdata

1. Войдите в панель управления alwaysdata
2. Перейдите в раздел "Базы данных"
3. Создайте новую PostgreSQL базу данных
4. Запишите следующие данные:
   - Хост (hostname)
   - Порт (обычно 5432)
   - Имя базы данных
   - Имя пользователя
   - Пароль

### 2. Настройка переменных окружения

Убедитесь, что в файле `.env` указаны следующие параметры:

```bash
# Настройки Telegram бота
BOT_TOKEN=your_telegram_bot_token_here

# Настройки PostgreSQL (alwaysdata)
DB_HOST=your_alwaysdata_host.alwaysdata.net
DB_PORT=5432
DB_NAME=your_database_name
DB_USER=your_username
DB_PASSWORD=your_password
```

### 3. Установка зависимостей

Установите PostgreSQL драйвер:

```bash
pip install psycopg2-binary
```

Или обновите все зависимости:

```bash
pip install -r requirements.txt
```

### 4. Тестирование подключения

Запустите скрипт тестирования:

```bash
python test_postgresql_connection.py
```

Этот скрипт проверит:
- Наличие всех необходимых переменных окружения
- Подключение к PostgreSQL базе данных
- Создание таблиц
- Работу менеджера базы данных

## Структура файлов

### Обновленные файлы

- `database.py` - Менеджер PostgreSQL базы данных (заменил SQLite)
- `config.py` - Обновлены настройки для PostgreSQL
- `requirements.txt` - Добавлен psycopg2-binary
- Все файлы приложений обновлены для работы с PostgreSQL

### Удаленные файлы

- `database_postgresql.py` - больше не нужен
- `database_universal.py` - больше не нужен
- `migrate_to_postgresql.py` - больше не нужен
- `env_example.txt` - больше не нужен

## Особенности PostgreSQL

### Автоматическое создание таблиц

При первом запуске система автоматически создаст необходимые таблицы:

- `справочник_номеров` - справочник номеров
- `посетители` - данные посетителей

### Типы данных

PostgreSQL использует следующие типы данных:
- `SERIAL` для автоинкрементных ID
- `VARCHAR(50)` для номеров
- `VARCHAR(200)` для ФИО
- `INTEGER` для числовых полей

### Совместимость

Все существующие функции работают с PostgreSQL:
- Регистрация посетителей
- Управление питанием
- Telegram бот
- Административная панель
- Экспорт данных

## Устранение неполадок

### Ошибка подключения

1. Проверьте правильность данных подключения в `.env`
2. Убедитесь, что база данных создана на alwaysdata
3. Проверьте, что IP адрес разрешен в настройках alwaysdata

### Ошибка импорта psycopg2

```bash
pip install psycopg2-binary
```

### Демо-режим

Если подключение к PostgreSQL не удается, система автоматически переключается в демо-режим для тестирования.

## Безопасность

- Никогда не коммитьте файл `.env` в репозиторий
- Используйте сложные пароли для базы данных
- Регулярно делайте резервные копии данных

## Производительность

PostgreSQL обеспечивает:
- Лучшую производительность при большом количестве данных
- Поддержку одновременных подключений
- Автоматическое резервное копирование (на alwaysdata)
- Масштабируемость

## Поддержка

При возникновении проблем:
1. Проверьте логи приложения
2. Запустите `test_postgresql_connection.py`
3. Убедитесь в корректности настроек alwaysdata
